<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peg by Peg – Teaching Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#efe6d6;
      --paper:#fffaf1;
      --ink:#3e2723;
      --ink2:#5d4037;
      --wood:#8b5a2b;
      --frame:#5d4037;
      --accent:#c49a6c;
      --p1:#c0392b;
      --p2:#2980b9;
      --ok:#2e7d32;
      --warn:#c62828;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:'Lora',serif;
      background:var(--bg);
      color:var(--ink);
    }
    a{color:inherit;}

    /* NAV */
    .nav{
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      align-items:center;
      gap:.5rem;
      padding:.6rem 1rem;
      background:var(--paper);
      border-bottom:1px solid #e0d0b0;
    }
    .nav h1{
      margin:0 1rem 0 0;
      font:700 1.15rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .nav button{
      border:1px solid #d9c7a7;
      background:#fff;
      padding:.3rem .7rem;
      border-radius:.6rem;
      cursor:pointer;
      font:600 .85rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .nav button.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--frame);
    }

    /* LAYOUT */
    .wrap{max-width:1100px;margin:1.2rem auto;padding:0 1rem;}
    section{display:none;}
    section.active{display:block;}
    h2{
      font:700 1.35rem 'Merriweather',serif;
      color:var(--ink2);
      margin:.2rem 0 .6rem;
    }
    .card{
      background:var(--paper);
      border:1px solid #e3d6be;
      border-radius:12px;
      padding:1rem;
      margin:0 0 1rem;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .muted{color:#6d584a;font-size:.93rem;}
    .tag{
      display:inline-block;
      padding:.12rem .45rem;
      font:700 .7rem 'Merriweather',serif;
      border-radius:.4rem;
      border:1px solid #d2c1a4;
      background:#fff;
      margin-right:.25rem;
    }
    .row{display:flex;flex-wrap:wrap;gap:1rem;}
    .col{flex:1 1 380px;}

    /* TRAINER BOARD VISUALS */
    .board{
      background:var(--wood);
      border:8px solid var(--frame);
      border-radius:16px;
      padding:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.35), inset 0 0 10px rgba(0,0,0,.25);
    }
    .track{
      position:relative;
      height:52px;
      margin:14px 0;
      border:2px solid var(--frame);
      background:#d2b48c;
      border-radius:10px;
      box-shadow:inset 0 0 6px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .track-label{
      position:absolute;
      top:-18px;
      left:6px;
      font:700 .78rem 'Merriweather',serif;
      color:#fff;
      text-shadow:0 1px 2px rgba(0,0,0,.4);
    }
    .holes{
      position:absolute;
      top:25px;
      left:10px;
      width:calc(100% - 20px);
      display:flex;
      justify-content:space-between;
      pointer-events:none;
    }
    .hole{
      width:4px;
      height:4px;
      border-radius:50%;
      background:#3b2618;
      box-shadow:inset 0 1px 1px rgba(0,0,0,.4);
      flex-shrink:0;
    }
    .peg{
      position:absolute;
      top:14px;
      width:20px;
      height:20px;
      border-radius:50%;
      border:2px solid #fff;
      box-shadow:0 2px 5px rgba(0,0,0,.35), inset 0 0 4px rgba(255,255,255,.5);
      transition:left .22s ease-out;
    }
    .peg.p1{background:var(--p1);}
    .peg.p2{background:var(--p2);}
    .peg.hop{animation:hop .22s ease-out;}
    @keyframes hop{
      0%{transform:translateY(0);}
      40%{transform:translateY(-16px);}
      100%{transform:translateY(0);}
    }

    /* CONTROLS */
    .controls{margin-top:.5rem;}
    .btn{
      border:1px solid #c9b693;
      background:#fff;
      padding:.35rem .6rem;
      margin:.15rem .15rem 0 0;
      border-radius:.45rem;
      font:600 .85rem 'Merriweather',serif;
      cursor:pointer;
    }
    .btn.primary{
      background:var(--accent);
      color:#fff;
      border-color:var(--frame);
    }
    .status{
      margin-top:.25rem;
      font-family:ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:.86rem;
      min-height:1.2em;
    }
    .status.ok{color:var(--ok);}
    .status.warn{color:var(--warn);}
    input[type="number"]{
      padding:.3rem;
      border-radius:.3rem;
      border:1px solid #d2c1a4;
      width:80px;
      font-family:inherit;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <h1>Peg by Peg</h1>
    <button data-tab="overview" class="active">Levels Overview</button>
    <button data-tab="trainer">Trainer Board (Lv 1–3)</button>
    <button data-tab="hands">Hand Scoring (Lv 4)</button>
    <button data-tab="discard">Discard & Crib (Lv 5)</button>
    <button data-tab="official">Official 121 Board (Lv 6)</button>
  </div>

  <div class="wrap">
    <!-- OVERVIEW -->
    <section id="overview" class="active">
      <div class="card">
        <h2>6-Level Cribbage Teaching Path</h2>
        <p class="muted">
          One rules spine, many faces. Each level is a real mini-game. Use the Trainer Board for Levels 1–3,
          then add hand counting, discarding, and full-game play.
        </p>
        <ol class="muted">
          <li><strong>Level 1 – Peg to 31</strong>: running count, ≤31, last card, 31. Race to ~20 pts.</li>
          <li><strong>Level 2 – Pattern Scoring</strong>: add fifteens (2), pairs (2/6/12), runs (N). To ~40 pts.</li>
          <li><strong>Level 3 – Full Pegging</strong>: add “Go”, segment resets, 31 vs last. To ~60 pts.</li>
          <li><strong>Level 4 – The Show</strong>: full hand counting (Fifteens → Pairs → Runs → Flush → Nobs).</li>
          <li><strong>Level 5 – Discarding</strong>: my crib vs their crib; feed vs poison.</li>
          <li><strong>Level 6 – Full Game</strong>: deal → discard → pegging → show → crib to 121.</li>
        </ol>
        <p><span class="tag">Usage</span> Print this URL as a QR on your boards & cards. It’s your live companion coach.</p>
      </div>
    </section>

    <!-- TRAINER BOARD (L1–L3) -->
    <section id="trainer">
      <div class="row">
        <div class="col">
          <div class="card">
            <h2>Trainer Board – Peg & Explain</h2>
            <p class="muted">
              This is a teaching board. The <strong>front peg</strong> shows where you are now.
              The <strong>back peg</strong> shows where you were. Each button moves that many holes.
            </p>
            <div>
              <span class="tag">Level</span>
              <select id="trainer-level">
                <option value="1">1 – Peg to 31</option>
                <option value="2">2 – +15s / Pairs / Runs</option>
                <option value="3">3 – +Go & Segments</option>
              </select>
              <span class="tag" style="margin-left:.4rem;">Track</span>
              <select id="trainer-track">
                <option value="30">0–30 (short)</option>
                <option value="61">0–61 (standard)</option>
                <option value="121" selected>0–121 (full)</option>
              </select>
              <button class="btn primary" id="trainer-apply">Apply</button>
              <button class="btn" id="trainer-reset">New Game</button>
            </div>

            <div class="board" style="margin-top:.6rem;">
              <div class="track" id="track-p1">
                <div class="track-label">Player 1</div>
                <div class="holes" id="holes-p1"></div>
                <div class="peg p1" id="p1-front"></div>
                <div class="peg p1" id="p1-back"></div>
              </div>
              <div class="track" id="track-p2">
                <div class="track-label">Player 2</div>
                <div class="holes" id="holes-p2"></div>
                <div class="peg p2" id="p2-front"></div>
                <div class="peg p2" id="p2-back"></div>
              </div>
            </div>

            <div class="controls">
              <div><strong>P1 Peg:</strong>
                <button class="btn" data-move="1:1">+1</button>
                <button class="btn" data-move="1:2">+2</button>
                <button class="btn" data-move="1:3">+3</button>
                <button class="btn" data-move="1:4">+4</button>
                <button class="btn" data-move="1:5">+5</button>
                <button class="btn" data-move="1:-1">-1</button>
              </div>
              <div><strong>P2 Peg:</strong>
                <button class="btn" data-move="2:1">+1</button>
                <button class="btn" data-move="2:2">+2</button>
                <button class="btn" data-move="2:3">+3</button>
                <button class="btn" data-move="2:4">+4</button>
                <button class="btn" data-move="2:5">+5</button>
                <button class="btn" data-move="2:-1">-1</button>
              </div>
              <div class="status" id="trainer-status"></div>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card">
            <h2>How to Use by Level</h2>
            <p id="trainer-notes" class="muted"></p>
            <hr/>
            <h3>31 Check Mini-Drill</h3>
            <p class="muted">Use this with Level 1 to reinforce "never over 31".</p>
            <div>
              <input type="number" id="count-input" min="0" max="31" value="0">
              <button class="btn" id="check-31">Check</button>
            </div>
            <div class="status" id="check-31-out"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- HANDS (stub for Lv 4) -->
    <section id="hands">
      <div class="card">
        <h2>Hand Scoring Trainer (Level 4)</h2>
        <p class="muted">
          This pane will walk players through scoring a 4-card hand + starter:
          first all fifteens, then pairs, then runs, flush, and nobs.
          For now, use it as a rules reference and visual anchor.
        </p>
        <ul class="muted">
          <li>Fifteens: every unique combo = 2 points</li>
          <li>Pairs: 2 / 6 / 12 for 2/3/4 of a kind</li>
          <li>Runs: count cards in each valid run; handle double/triple runs</li>
          <li>Flush: 4 in hand = 4; with starter = 5; crib needs all 5</li>
          <li>Nobs: Jack in hand, same suit as starter = 1</li>
        </ul>
      </div>
    </section>

    <!-- DISCARD (stub for Lv 5) -->
    <section id="discard">
      <div class="card">
        <h2>Discard & Crib Trainer (Level 5)</h2>
        <p class="muted">
          This pane will simulate "keep 4, throw 2" decisions and show
          expected value for my crib vs their crib. For now, it documents the core ideas:
        </p>
        <ul class="muted">
          <li>When it's your crib: feed it friends (5s, pairs, connectors, same-suit).</li>
          <li>When it's their crib: poison it (gappy, off-suit, avoid 5s/pairs).</li>
          <li>Always think "hand points + crib points" as one ecosystem.</li>
        </ul>
      </div>
    </section>

    <!-- OFFICIAL BOARD (stub for Lv 6) -->
    <section id="official">
      <div class="card">
        <h2>Official 121 Board (Level 6)</h2>
        <p class="muted">
          Here you’ll play full cribbage: deal, discard to crib, pegging with all rules, show each hand, then count the crib.
          This digital view will mirror a clean 121 board with a log of scoring events.
        </p>
        <p class="muted">
          For now, use your physical Peg by Peg board on the "classic" face and this page as your rules spine.
        </p>
      </div>
    </section>
  </div>

<script>
/* ---------- SIMPLE TAB NAV ---------- */
document.querySelectorAll('.nav button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

/* ---------- TRAINER BOARD STATE ---------- */

const trainer = {
  level: 1,
  max: 121,
  spacing: 5,
  players: {
    1: { front: 0, back: 0 },
    2: { front: 0, back: 0 }
  }
};

const els = {
  trackP1: document.getElementById('track-p1'),
  trackP2: document.getElementById('track-p2'),
  holesP1: document.getElementById('holes-p1'),
  holesP2: document.getElementById('holes-p2'),
  p1f: document.getElementById('p1-front'),
  p1b: document.getElementById('p1-back'),
  p2f: document.getElementById('p2-front'),
  p2b: document.getElementById('p2-back'),
  levelSel: document.getElementById('trainer-level'),
  trackSel: document.getElementById('trainer-track'),
  applyBtn: document.getElementById('trainer-apply'),
  resetBtn: document.getElementById('trainer-reset'),
  status: document.getElementById('trainer-status'),
  notes: document.getElementById('trainer-notes'),
  check31Btn: document.getElementById('check-31'),
  check31Out: document.getElementById('check-31-out'),
  countInput: document.getElementById('count-input')
};

/* Build holes based on max points */
function buildHoles(){
  const inner = els.trackP1.clientWidth - 20;
  trainer.spacing = inner > 0 ? inner / trainer.max : 5;

  [els.holesP1, els.holesP2].forEach(container => {
    container.innerHTML = '';
    for(let i=0;i<=trainer.max;i++){
      const d = document.createElement('div');
      d.className = 'hole';
      container.appendChild(d);
    }
  });
  updatePegPositions();
}

/* Update peg DOM positions from state */
function updatePegPositions(){
  const s1 = trainer.players[1];
  const s2 = trainer.players[2];

  els.p1f.style.left = (s1.front * trainer.spacing) + 'px';
  els.p1b.style.left = (s1.back  * trainer.spacing) + 'px';
  els.p2f.style.left = (s2.front * trainer.spacing) + 'px';
  els.p2b.style.left = (s2.back  * trainer.spacing) + 'px';
}

/* Reset scores for new game */
function resetTrainer(){
  trainer.players[1].front = trainer.players[1].back = 0;
  trainer.players[2].front = trainer.players[2].back = 0;
  updatePegPositions();
  setStatus('New game: both players at start.');
}

/* Move a player by delta holes with front/back behavior */
function movePeg(player, delta){
  const p = trainer.players[player];
  if (!p || delta === 0) return;

  if (delta > 0){
    // classic cribbage leap: back peg moves to previous front; front jumps forward
    p.back = p.front;
    p.front = Math.min(trainer.max, p.front + delta);
  } else {
    // negative = correction: move front back; keep back one step behind if needed
    const newFront = Math.max(0, p.front + delta);
    p.front = newFront;
    if (p.back > p.front){
      p.back = p.front; // don't leave back ahead of front
    }
  }

  animateFront(player);
  updatePegPositions();
  setStatus(`P${player} moved ${delta>0?('+'+delta):delta} peg(s). Now at ${trainer.players[player].front}.`);
}

/* Little hop animation for front peg */
function animateFront(player){
  const peg = player === 1 ? els.p1f : els.p2f;
  peg.classList.add('hop');
  setTimeout(()=>peg.classList.remove('hop'), 220);
}

/* Level notes text */
function updateLevelNotes(){
  let txt = '';
  if (trainer.level === 1){
    txt = 'Level 1 – Use this board to teach the rhythm of pegging. Each button is that many points. Say the count aloud. Focus on staying at or under 31 and rewarding the last card / exact 31 in your separate examples.';
  } else if (trainer.level === 2){
    txt = 'Level 2 – Same physical motion, but start talking about WHY those pegs move: 15s for 2, pairs for 2/6/12, and runs. Use the moves to narrate the patterns, even if you are entering simplified values.';
  } else {
    txt = 'Level 3 – Introduce “Go”, segment resets, and 31 vs last-card. Use the moves plus your voice to show that some points happen when the run closes, not just when a card is played.';
  }
  els.notes.textContent = txt;
}

/* Status helper */
function setStatus(msg, type){
  els.status.textContent = msg;
  els.status.className = 'status' + (type ? ' ' + type : '');
}

/* 31 drill logic */
function setup31Drill(){
  els.check31Btn.addEventListener('click', () => {
    const n = parseInt(els.countInput.value,10);
    if (Number.isNaN(n) || n < 0){
      els.check31Out.textContent = 'Enter a number from 0 to 31.';
      els.check31Out.className = 'status warn';
    } else if (n > 31){
      els.check31Out.textContent = 'Too high. In pegging you can never exceed 31.';
      els.check31Out.className = 'status warn';
    } else if (n === 31){
      els.check31Out.textContent = 'Exactly 31 → 2 points.';
      els.check31Out.className = 'status ok';
    } else {
      els.check31Out.textContent = 'Valid running total. Next card must keep you ≤ 31.';
      els.check31Out.className = 'status';
    }
  });
}

/* Apply level + track settings */
function applyTrainerSettings(){
  trainer.level = parseInt(els.levelSel.value,10);
  trainer.max = parseInt(els.trackSel.value,10);
  buildHoles();
  resetTrainer();
  updateLevelNotes();
}

/* Wire buttons */
els.applyBtn.addEventListener('click', applyTrainerSettings);
els.resetBtn.addEventListener('click', resetTrainer);

document.querySelectorAll('[data-move]').forEach(btn => {
  btn.addEventListener('click', () => {
    const [playerStr, deltaStr] = btn.dataset.move.split(':');
    movePeg(parseInt(playerStr,10), parseInt(deltaStr,10));
  });
});

/* Init on load & resize */
window.addEventListener('DOMContentLoaded', () => {
  applyTrainerSettings();
  setup31Drill();
});
window.addEventListener('resize', buildHoles);
</script>
</body>
</html>
