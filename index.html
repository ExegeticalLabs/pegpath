<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Peg by Peg – Trainer Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f2e7d8;
      --paper: #fffaf1;
      --ink: #3e2723;
      --ink2: #5d4037;
      --wood: #8b5a2b;
      --frame: #5d4037;
      --accent: #c49a6c;
      --p1: #c0392b;
      --p2: #2980b9;
      --ok: #2e7d32;
      --warn: #c62828;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Lora", serif;
      background: var(--bg);
      color: var(--ink);
    }
    h1, h2 {
      font-family: "Merriweather", serif;
      margin: 0;
      color: var(--ink2);
    }
    .wrap {
      max-width: 1100px;
      margin: 1rem auto 2rem;
      padding: 0 1rem;
    }
    .card {
      background: var(--paper);
      border-radius: 14px;
      border: 1px solid #e0d3c0;
      padding: 1rem 1.2rem;
      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
      margin-bottom: 1rem;
    }
    .muted { color: #6d584a; font-size: 0.92rem; }
    .row { display: flex; flex-wrap: wrap; gap: 1rem; }
    .col { flex: 1 1 420px; }

    /* Trainer Board visuals */
    .board-wrap h2 { margin-bottom: 0.4rem; }
    .board {
      background: var(--wood);
      border: 8px solid var(--frame);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35), inset 0 0 10px rgba(0,0,0,0.25);
    }
    .track {
      position: relative;
      height: 64px;
      margin: 16px 0;
      background: #d2b48c;
      border-radius: 10px;
      border: 2px solid var(--frame);
      box-shadow: inset 0 0 6px rgba(0,0,0,0.25);
      padding: 18px 12px 8px;
      overflow: hidden;
    }
    .track-label {
      position: absolute;
      top: 2px;
      left: 10px;
      font: 700 0.8rem "Merriweather", serif;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }
    .holes {
      position: absolute;
      left: 12px;
      right: 12px;
      top: 28px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .hole {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: #3b2618;
      box-shadow: inset 0 1px 1px rgba(0,0,0,0.35);
      flex-shrink: 0;
    }
    .nums {
      position: absolute;
      left: 8px;
      right: 8px;
      bottom: 4px;
      font-size: 0.6rem;
      color: #f5e5cf;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .nums span {
      min-width: 10px;
      text-align: center;
      opacity: 0.9;
    }
    .peg {
      position: absolute;
      top: 18px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.4), inset 0 0 4px rgba(255,255,255,0.6);
      transition: left 0.25s ease-out;
    }
    .peg.p1 { background: var(--p1); }
    .peg.p2 { background: var(--p2); }
    .peg.hop {
      animation: hop 0.22s ease-out;
    }
    @keyframes hop {
      0% { transform: translateY(0); }
      40% { transform: translateY(-16px); }
      100% { transform: translateY(0); }
    }

    .controls label {
      font-size: 0.8rem;
      margin-right: 0.2rem;
      font-weight: 600;
      color: var(--ink2);
    }
    select {
      padding: 0.2rem 0.4rem;
      border-radius: 6px;
      border: 1px solid #c8b79e;
      font-family: "Lora", serif;
      font-size: 0.8rem;
    }
    .btn {
      appearance: none;
      border: 1px solid #c8b79e;
      background: #fff;
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      cursor: pointer;
      font: 600 0.8rem "Merriweather", serif;
      color: var(--ink2);
      margin: 0.15rem 0.18rem 0 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.18);
    }
    .btn.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--frame);
    }
    .btn:hover {
      background: #f3e6d4;
    }
    .btn.primary:hover {
      background: #b3814a;
    }

    .status {
      margin-top: 0.4rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 0.78rem;
      white-space: nowrap;
      overflow-x: auto;
    }
    .status.ok { color: var(--ok); }
    .status.warn { color: var(--warn); }

    /* Running count / cards */
    .card-buttons .btn {
      min-width: 32px;
      text-align: center;
    }
    .count-display {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 0.82rem;
      margin-top: 0.25rem;
    }
    @media (max-width: 720px) {
      .track { height: 60px; }
      .nums span { font-size: 0.5rem; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Peg by Peg – Trainer Board (True Leapfrog)</h1>
    <p class="muted">
      Use this board to teach proper two-peg leapfrog scoring and pegging count,
      without weird animations or wrong math. Buttons on the left move pegs
      (score), card buttons on the right track the 0–31 pegging <em>count</em>.
    </p>
  </div>

  <div class="row">
    <!-- LEFT: Board + peg controls -->
    <div class="col board-wrap">
      <div class="card">
        <div class="controls" style="margin-bottom:0.4rem;">
          <label for="trackSel">Track:</label>
          <select id="trackSel">
            <option value="30">0–30</option>
            <option value="61">0–61</option>
            <option value="121" selected>0–121</option>
          </select>
          <button class="btn primary" id="applyTrack">Apply</button>
          <button class="btn" id="resetGame">Reset Game</button>
        </div>

        <div class="board">
          <!-- Player 1 -->
          <div class="track" id="track1">
            <div class="track-label">P1</div>
            <div class="holes" id="holes1"></div>
            <div class="nums" id="nums1"></div>
            <div class="peg p1" id="p1a"></div>
            <div class="peg p1" id="p1b"></div>
          </div>
          <!-- Player 2 -->
          <div class="track" id="track2">
            <div class="track-label">P2</div>
            <div class="holes" id="holes2"></div>
            <div class="nums" id="nums2"></div>
            <div class="peg p2" id="p2a"></div>
            <div class="peg p2" id="p2b"></div>
          </div>
        </div>

        <div class="controls">
          <p class="muted">Press a button when a player scores that many <strong>points</strong> (not cards). Only the back peg leaps ahead, just like on a real board.</p>

          <div>
            <strong>P1:</strong>
            <button class="btn" data-score="1-1">+1</button>
            <button class="btn" data-score="1-2">+2</button>
            <button class="btn" data-score="1-3">+3</button>
            <button class="btn" data-score="1-4">+4</button>
            <button class="btn" data-score="1-5">+5</button>
          </div>
          <div>
            <strong>P2:</strong>
            <button class="btn" data-score="2-1">+1</button>
            <button class="btn" data-score="2-2">+2</button>
            <button class="btn" data-score="2-3">+3</button>
            <button class="btn" data-score="2-4">+4</button>
            <button class="btn" data-score="2-5">+5</button>
          </div>
          <div class="status" id="pegStatus"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Level notes + card-based count -->
    <div class="col">
      <div class="card">
        <h2>Level Notes</h2>
        <p class="muted">
          Focus: correct leapfrog motion. Current total is the peg <em>ahead</em>;
          previous total is the peg behind. On each score, move only the back peg
          ahead by that many points.
        </p>
        <ul class="muted">
          <li>Use short tracks (0–30) for drills.</li>
          <li>Introduce 15s / pairs / runs as separate “score” inputs later.</li>
          <li>Board never lies: peg position = score.</li>
        </ul>
        <hr>
        <h3>Pegging Count Helper (0–31)</h3>
        <p class="muted">
          Click the card values in the order played. This tracks the running count only;
          it does <strong>not</strong> move the pegs for you.
        </p>
        <div class="card-buttons">
          <button class="btn" data-card="A">A</button>
          <button class="btn" data-card="2">2</button>
          <button class="btn" data-card="3">3</button>
          <button class="btn" data-card="4">4</button>
          <button class="btn" data-card="5">5</button>
          <button class="btn" data-card="6">6</button>
          <button class="btn" data-card="7">7</button>
          <button class="btn" data-card="8">8</button>
          <button class="btn" data-card="9">9</button>
          <button class="btn" data-card="10">10</button>
          <button class="btn" data-card="J">J</button>
          <button class="btn" data-card="Q">Q</button>
          <button class="btn" data-card="K">K</button>
        </div>
        <div style="margin-top:0.3rem;">
          <button class="btn" id="goBtn">Go / Reset Count</button>
          <button class="btn" id="undoCard">Undo Last Card</button>
        </div>
        <div class="count-display" id="countInfo">
          Count: 0 &nbsp;|&nbsp; Sequence:
        </div>
        <div class="status" id="countStatus"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ========== PEG BOARD STATE (TRUE LEAPFROG) ========== */

const board = {
  max: 121,
  players: {
    1: { a: 0, b: 0 }, // positions of peg a and peg b (holes)
    2: { a: 0, b: 0 }
  }
};

const pegEls = {
  1: { a: document.getElementById('p1a'), b: document.getElementById('p1b'),
       holes: document.getElementById('holes1'), nums: document.getElementById('nums1'),
       track: document.getElementById('track1') },
  2: { a: document.getElementById('p2a'), b: document.getElementById('p2b'),
       holes: document.getElementById('holes2'), nums: document.getElementById('nums2'),
       track: document.getElementById('track2') }
};

const trackSel = document.getElementById('trackSel');
const pegStatus = document.getElementById('pegStatus');

function buildTrack(player) {
  const max = board.max;
  const els = pegEls[player];

  // Build holes
  els.holes.innerHTML = '';
  for (let i = 0; i <= max; i++) {
    const d = document.createElement('div');
    d.className = 'hole';
    els.holes.appendChild(d);
  }

  // Build numbers (sparse so it's readable)
  els.nums.innerHTML = '';
  const step = max <= 30 ? 1 : (max <= 61 ? 5 : 10);
  for (let i = 0; i <= max; i += step) {
    const s = document.createElement('span');
    s.textContent = i;
    els.nums.appendChild(s);
  }

  // Position pegs at 0
  placePegs(player);
}

function placePegs(player) {
  const max = board.max;
  const els = pegEls[player];
  const p = board.players[player];

  const trackWidth = els.track.clientWidth - 24; // padding left/right
  const spacing = trackWidth / max;

  const posA = 12 + p.a * spacing;
  const posB = 12 + p.b * spacing;

  els.a.style.left = posA + 'px';
  els.b.style.left = posB + 'px';
}

function currentScore(player) {
  const p = board.players[player];
  return Math.max(p.a, p.b);
}

/**
 * Leapfrog scoring:
 * - Identify which peg is front (higher position) and which is back.
 * - NewTotal = front + points.
 * - Move ONLY the back peg to NewTotal.
 * - The peg that did not move now marks previous total.
 */
function scorePoints(player, points) {
  if (points <= 0) return; // keep simple; no negative adjust here

  const p = board.players[player];

  // Determine which peg is front/back
  let frontPeg, backPeg;
  if (p.a >= p.b) { frontPeg = 'a'; backPeg = 'b'; }
  else { frontPeg = 'b'; backPeg = 'a'; }

  const frontPos = p[frontPeg];
  let newTotal = frontPos + points;
  if (newTotal > board.max) newTotal = board.max;

  const prevTotal = frontPos;      // previous score marker
  const movedFrom = p[backPeg];

  // Move back peg to new total; front peg stays at prevTotal
  p[backPeg] = newTotal;
  p[frontPeg] = prevTotal;

  // Animate moved peg
  const movedEl = pegEls[player][backPeg];
  movedEl.classList.add('hop');
  setTimeout(()=>movedEl.classList.remove('hop'), 220);

  // Reposition both
  placePegs(player);

  // Status text
  const score = currentScore(player);
  pegStatus.className = 'status';
  pegStatus.textContent =
    `P${player} scores ${points}. Pegs now at ${prevTotal} and ${newTotal} (current score ${score}).`;
}

/* Reset board & track */
function resetGame() {
  board.players[1].a = board.players[1].b = 0;
  board.players[2].a = board.players[2].b = 0;
  buildTrack(1);
  buildTrack(2);
  pegStatus.className = 'status';
  pegStatus.textContent = 'New game. Both players at 0.';
}

/* Apply track length change */
function applyTrackLength() {
  board.max = parseInt(trackSel.value, 10);
  resetGame();
}

/* Wiring scoring buttons */
document.querySelectorAll('[data-score]').forEach(btn => {
  btn.addEventListener('click', () => {
    const [pStr, ptsStr] = btn.dataset.score.split('-');
    const p = parseInt(pStr, 10);
    const pts = parseInt(ptsStr, 10);
    scorePoints(p, pts);
  });
});

document.getElementById('applyTrack').addEventListener('click', applyTrackLength);
document.getElementById('resetGame').addEventListener('click', resetGame);
window.addEventListener('resize', () => { placePegs(1); placePegs(2); });

/* ========== PEGGING COUNT (CARDS → 0–31) ========== */

const countInfo = document.getElementById('countInfo');
const countStatus = document.getElementById('countStatus');
let count = 0;
let sequence = [];

function cardValue(label) {
  if (label === 'A') return 1;
  if (label === 'J' || label === 'Q' || label === 'K') return 10;
  const n = parseInt(label, 10);
  if (!isNaN(n)) {
    if (n >= 2 && n <= 10) return n;
  }
  return 0;
}

function refreshCountDisplay(msgCls, msgText) {
  countInfo.textContent =
    `Count: ${count} | Sequence: ${sequence.join('  ') || ''}`;
  countStatus.className = 'status ' + (msgCls || '');
  countStatus.textContent = msgText || '';
}

document.querySelectorAll('[data-card]').forEach(btn => {
  btn.addEventListener('click', () => {
    const label = btn.dataset.card;
    const v = cardValue(label);
    if (count + v > 31) {
      refreshCountDisplay('warn',
        `Cannot play ${label}: would make ${count + v} (over 31). Say "Go".`);
      return;
    }
    count += v;
    sequence.push(label);

    if (count === 15) {
      refreshCountDisplay('ok', '15 for 2.');
    } else if (count === 31) {
      refreshCountDisplay('ok', '31 for 2. Reset count for next sequence.');
    } else {
      refreshCountDisplay('', '');
    }
  });
});

document.getElementById('goBtn').addEventListener('click', () => {
  count = 0;
  sequence = [];
  refreshCountDisplay('', 'Count reset (Go / new sequence).');
});

document.getElementById('undoCard').addEventListener('click', () => {
  if (!sequence.length) {
    refreshCountDisplay('', 'Nothing to undo.');
    return;
  }
  const last = sequence.pop();
  count -= cardValue(last);
  if (count < 0) count = 0;
  refreshCountDisplay('', `Undid ${last}.`);
});

/* ========== INIT ========== */
applyTrackLength();
</script>
</body>
</html>
