<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peg by Peg – Teaching Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#efe6d6;
      --paper:#fffaf1;
      --ink:#3e2723;
      --ink2:#5d4037;
      --wood:#8b5a2b;
      --frame:#5d4037;
      --accent:#c49a6c;
      --p1:#c0392b;
      --p2:#2980b9;
      --ok:#2e7d32;
      --warn:#c62828;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Lora',serif;
      background:var(--bg);
      color:var(--ink);
    }
    a{color:inherit;text-decoration:none}
    /* NAV */
    .nav{
      position:sticky;top:0;z-index:20;
      display:flex;align-items:center;gap:.5rem;
      padding:.6rem 1rem;
      background:var(--paper);
      border-bottom:1px solid #e0d0b0;
    }
    .nav h1{
      margin:0 .75rem 0 0;
      font:700 1.15rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .nav button{
      appearance:none;
      border:1px solid #d9c7a7;
      background:#fff;
      padding:.35rem .7rem;
      border-radius:.65rem;
      cursor:pointer;
      font:600 .86rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .nav button.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--frame);
    }

    /* LAYOUT */
    .wrap{max-width:1100px;margin:1rem auto;padding:0 1rem 1.5rem}
    section{display:none}
    section.active{display:block}
    h2{
      margin:.2rem 0 .6rem;
      font:700 1.35rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .card{
      background:var(--paper);
      border:1px solid #e3d6be;
      border-radius:12px;
      padding:1rem 1.15rem;
      margin:0 0 1rem;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .muted{color:#6d584a;font-size:.92rem}
    .tag{
      display:inline-block;
      font:700 .72rem 'Merriweather',serif;
      padding:.12rem .4rem;
      margin-right:.25rem;
      border-radius:.4rem;
      border:1px solid #d2c1a4;
      background:#fff;
      color:var(--ink2);
    }
    .row{display:flex;flex-wrap:wrap;gap:1rem}
    .col{flex:1 1 380px}

    /* TRAINER BOARD */
    .board{
      background:var(--wood);
      border:8px solid var(--frame);
      border-radius:16px;
      padding:14px 16px;
      box-shadow:0 6px 20px rgba(0,0,0,.35), inset 0 0 10px rgba(0,0,0,.25);
    }
    .track{
      position:relative;
      height:52px;
      margin:16px 0;
      border:2px solid var(--frame);
      background:#d2b48c;
      border-radius:10px;
      box-shadow:inset 0 0 6px rgba(0,0,0,.3);
      overflow:hidden;
    }
    .label{
      position:absolute;
      top:-17px;
      left:6px;
      font:700 .78rem 'Merriweather',serif;
      color:#fffaf1;
    }
    .holes{
      position:absolute;
      top:25px;
      left:10px;
      width:calc(100% - 20px);
      display:flex;
      justify-content:space-between;
      pointer-events:none;
    }
    .hole{
      width:4px;height:4px;
      border-radius:50%;
      background:#3b2618;
      box-shadow:inset 0 1px 1px rgba(0,0,0,.4);
      flex-shrink:0;
    }
    .peg{
      position:absolute;
      top:15px;
      width:20px;height:20px;
      border-radius:50%;
      border:2px solid #fff;
      box-shadow:0 2px 5px rgba(0,0,0,.35), inset 0 0 4px rgba(255,255,255,.5);
      transition:left .2s ease-out;
    }
    .peg.p1{background:var(--p1);}
    .peg.p2{background:var(--p2);}
    .peg.hop{animation:hop .22s ease-out;}
    @keyframes hop{
      0%{transform:translateY(0);}
      40%{transform:translateY(-16px);}
      100%{transform:translateY(0);}
    }

    /* BUTTONS / STATUS */
    .btn{
      appearance:none;
      border:1px solid #c9b693;
      background:#fff;
      padding:.35rem .65rem;
      margin:.15rem .2rem .15rem 0;
      border-radius:.5rem;
      cursor:pointer;
      font:600 .9rem 'Merriweather',serif;
      color:var(--ink2);
    }
    .btn.primary{
      background:var(--accent);
      color:#fff;
      border-color:var(--frame);
    }
    .status{
      margin-top:.4rem;
      font-family:ui-monospace,Menlo,monospace;
      font-size:.86rem;
      white-space:pre-wrap;
    }
    .status.ok{color:var(--ok);}
    .status.warn{color:var(--warn);}
    .scoreline{
      margin-top:.1rem;
      font:700 .9rem 'Merriweather',serif;
      color:var(--ink2);
    }
    input[type="number"]{
      padding:.25rem .35rem;
      border-radius:.4rem;
      border:1px solid #c9b693;
      font-family:inherit;
      width:80px;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <h1>Peg by Peg</h1>
    <button class="active" data-tab="overview">Levels Overview</button>
    <button data-tab="trainer">Trainer Board (Lv 1–3)</button>
    <button data-tab="hands">Hand Scoring (Lv 4)</button>
    <button data-tab="discard">Discard & Crib (Lv 5)</button>
    <button data-tab="official">Official 121 Board (Lv 6)</button>
  </div>

  <div class="wrap">

    <!-- LEVELS OVERVIEW -->
    <section id="overview" class="active">
      <div class="card">
        <h2>6-Level Cribbage Teaching Path</h2>
        <p class="muted">
          One rules spine, many faces. Use the Trainer Board and mini-games to master each layer,
          then graduate students to the full 121 board.
        </p>
        <ol class="muted">
          <li><strong>Level 1 – Peg to 31</strong>: running count, ≤31, last card &amp; 31. Play to 20 pts.</li>
          <li><strong>Level 2 – Pattern Scoring</strong>: 15s (2), pairs (2/6/12), runs. Play to 40 pts.</li>
          <li><strong>Level 3 – Full Pegging</strong>: add “Go”, segments, last vs 31. Play to 60 pts.</li>
          <li><strong>Level 4 – Counting Hands</strong>: fifteens → pairs → runs → flush → nobs.</li>
          <li><strong>Level 5 – Discarding</strong>: my crib vs their crib, feed vs poison.</li>
          <li><strong>Level 6 – Full Game</strong>: deal → discard → pegging → show → crib (121).</li>
        </ol>
        <p><span class="tag">How to use</span> Pick a level above; that view becomes the on-table coach for that slice of the game.</p>
      </div>
    </section>

    <!-- TRAINER BOARD: LEVELS 1–3 -->
    <section id="trainer">
      <div class="row">
        <div class="col">
          <div class="card">
            <div style="display:flex;flex-wrap:wrap;align-items:center;gap:.5rem;margin-bottom:.5rem;">
              <h2 style="margin-right:.5rem;">Trainer Board</h2>
              <span class="tag">Levels 1–3</span>
              <span class="muted">Choose level &amp; track, then score with the buttons.</span>
            </div>
            <div class="muted" style="margin-bottom:.4rem;">
              <label class="tag">Level</label>
              <select id="levelSel">
                <option value="1">1 – Peg to 31</option>
                <option value="2">2 – +15s / Pairs / Runs</option>
                <option value="3">3 – +Go &amp; Segments</option>
              </select>
              <label class="tag" style="margin-left:.35rem;">Track</label>
              <select id="trackSel">
                <option value="30">0–30</option>
                <option value="61">0–61</option>
                <option value="121" selected>0–121</option>
              </select>
              <button class="btn primary" id="applyBtn">Apply</button>
            </div>

            <div class="board">
              <div class="track" id="track1">
                <div class="label">P1</div>
                <div class="holes" id="holes1"></div>
                <div class="peg p1" id="p1-front"></div>
                <div class="peg p1" id="p1-back"></div>
              </div>
              <div class="track" id="track2">
                <div class="label">P2</div>
                <div class="holes" id="holes2"></div>
                <div class="peg p2" id="p2-front"></div>
                <div class="peg p2" id="p2-back"></div>
              </div>
            </div>

            <p class="muted" style="margin-top:.5rem;">
              Use these buttons to simulate pegging totals. Each click moves the pegs with
              proper cribbage-style leapfrog: the rear peg marks where you were, the front peg
              jumps to where you are now.
            </p>

            <div>
              <div><strong>P1:</strong>
                <button class="btn" data-play="1,1">+1</button>
                <button class="btn" data-play="1,2">+2</button>
                <button class="btn" data-play="1,3">+3</button>
                <button class="btn" data-play="1,4">+4</button>
                <button class="btn" data-play="1,5">+5</button>
                <button class="btn" data-play="1,-1">-1</button>
              </div>
              <div><strong>P2:</strong>
                <button class="btn" data-play="2,1">+1</button>
                <button class="btn" data-play="2,2">+2</button>
                <button class="btn" data-play="2,3">+3</button>
                <button class="btn" data-play="2,4">+4</button>
                <button class="btn" data-play="2,5">+5</button>
                <button class="btn" data-play="2,-1">-1</button>
              </div>
              <div style="margin-top:.35rem;">
                <button class="btn" id="goBtn">Say “Go”</button>
                <button class="btn" id="resetBtn">New Game</button>
              </div>
              <div class="scoreline" id="scoreLine"></div>
              <div class="status" id="status"></div>
            </div>
          </div>
        </div>

        <!-- Level notes + 31 drill -->
        <div class="col">
          <div class="card">
            <h2>Level Notes</h2>
            <p id="levelNotes" class="muted"></p>
            <hr>
            <h3 style="margin:.2rem 0 .4rem;">31 Drill</h3>
            <p class="muted">Check if a running count is valid.</p>
            <input id="countInput" type="number" min="0" max="40" value="0">
            <button class="btn" id="check31">Check</button>
            <div class="status" id="checkOut"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- HAND SCORING TRAINER (stub, safe) -->
    <section id="hands">
      <div class="card">
        <h2>Hand Scoring Trainer (Lv 4)</h2>
        <p class="muted">
          This view will walk the full counting mantra on real 5-card hands:
          Fifteens → Pairs → Runs → Flush → Nobs, with a breakdown that
          matches tournament cribbage. For now this is a placeholder so your
          navigation and teaching flow are wired.
        </p>
      </div>
    </section>

    <!-- DISCARD & CRIB TRAINER (stub) -->
    <section id="discard">
      <div class="card">
        <h2>Discard &amp; Crib Trainer (Lv 5)</h2>
        <p class="muted">
          Here you’ll deal 6, choose 4 to keep, send 2 to crib (yours vs theirs),
          and see both hand and crib scored with “feed vs poison” guidance.
          Stubbed for now; safe to ship visually.
        </p>
      </div>
    </section>

    <!-- OFFICIAL 121 BOARD (stub) -->
    <section id="official">
      <div class="card">
        <h2>Official 121 Board (Lv 6)</h2>
        <p class="muted">
          Final face: a clean 121 board with two pegs per player, an event log,
          and no training hints. Use once students graduate from the Trainer Board.
          Implementation stubbed here so your product story is complete.
        </p>
      </div>
    </section>
  </div>

  <script>
    /* ---------- TAB NAV ---------- */
    document.querySelectorAll('.nav button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.tab;
        document.getElementById(id).classList.add('active');
      });
    });

    /* ---------- TRAINER BOARD STATE ---------- */
    const trainer = {
      level: 1,
      max: 121,
      spacing: 5,
      players: {
        1: { front: 0, back: 0 },
        2: { front: 0, back: 0 }
      },
      // for 31 teaching; simple, not full engine
      count: 0,
      lastPlayer: null
    };

    const els = {
      track1: document.getElementById('track1'),
      track2: document.getElementById('track2'),
      holes1: document.getElementById('holes1'),
      holes2: document.getElementById('holes2'),
      p1f: document.getElementById('p1-front'),
      p1b: document.getElementById('p1-back'),
      p2f: document.getElementById('p2-front'),
      p2b: document.getElementById('p2-back'),
      levelSel: document.getElementById('levelSel'),
      trackSel: document.getElementById('trackSel'),
      applyBtn: document.getElementById('applyBtn'),
      resetBtn: document.getElementById('resetBtn'),
      goBtn: document.getElementById('goBtn'),
      status: document.getElementById('status'),
      scoreLine: document.getElementById('scoreLine'),
      levelNotes: document.getElementById('levelNotes'),
      countInput: document.getElementById('countInput'),
      checkBtn: document.getElementById('check31'),
      checkOut: document.getElementById('checkOut')
    };

    function setLevelNotes() {
      const L = trainer.level;
      let msg = '';
      if (L === 1) {
        msg = 'Level 1 – Peg to 31. Focus: saying the count aloud, never over 31, ' +
              'and who gets last card / exact 31. No 15s/pairs/runs yet.';
      } else if (L === 2) {
        msg = 'Level 2 – Add 15s (2 pts), pairs (2/6/12), and runs (1 per card). ' +
              'Use the same buttons, but now talk through why each score happens.';
      } else {
        msg = 'Level 3 – Full pegging layer: everything from 1 & 2 plus “Go”, ' +
              'segment resets, and the difference between last card (1) and 31 (2).';
      }
      els.levelNotes.textContent = msg;
    }

    function buildHoles() {
      const inner1 = els.track1.clientWidth - 20;
      trainer.spacing = inner1 > 0 ? inner1 / trainer.max : 5;

      [els.holes1, els.holes2].forEach(div => {
        div.innerHTML = '';
        for (let i = 0; i <= trainer.max; i++) {
          const d = document.createElement('div');
          d.className = 'hole';
          div.appendChild(d);
        }
      });

      // place pegs according to current state
      placePeg(1, true);
      placePeg(2, true);
    }

    function placePeg(player, instant=false) {
      const p = trainer.players[player];
      const frontEl = player === 1 ? els.p1f : els.p2f;
      const backEl = player === 1 ? els.p1b : els.p2b;
      const fLeft = p.front * trainer.spacing;
      const bLeft = p.back * trainer.spacing;

      if (instant) {
        frontEl.style.transition = 'none';
        backEl.style.transition = 'none';
      }
      frontEl.style.left = fLeft + 'px';
      backEl.style.left = bLeft + 'px';
      if (instant) {
        // force reflow, then restore transitions
        void frontEl.offsetWidth;
        frontEl.style.transition = '';
        backEl.style.transition = '';
      }
    }

    function updateScoreLine() {
      const s1 = trainer.players[1].front;
      const s2 = trainer.players[2].front;
      els.scoreLine.textContent = `Scores – P1: ${s1} | P2: ${s2}  (Track: 0–${trainer.max})`;
    }

    function setStatus(msg, cls='') {
      els.status.className = 'status ' + (cls || '');
      els.status.textContent = msg;
    }

    // Core: leapfrog animation that feels like a real board
    function scorePlayer(player, delta) {
      const p = trainer.players[player];

      // negative = correction: just move both pegs together
      if (delta < 0) {
        let target = Math.max(0, p.front + delta);
        p.front = target;
        p.back = target;
        placePeg(player, false);
        updateScoreLine();
        setStatus(`P${player} adjusted back to ${target}.`, 'warn');
        return;
      }

      if (delta === 0) return;

      // clamp to board
      let newFront = p.front + delta;
      if (newFront > trainer.max) newFront = trainer.max;

      // sequential leapfrog: back → old front, then front → new
      const frontEl = player === 1 ? els.p1f : els.p2f;
      const backEl = player === 1 ? els.p1b : els.p2b;

      // Step 1: move back peg up to current front
      backEl.style.left = (p.front * trainer.spacing) + 'px';

      // Step 2: after that transition, move front peg to newFront
      // and update state. Transition time is .2s; give it a bit.
      setTimeout(() => {
        p.back = p.front;
        p.front = newFront;
        frontEl.style.left = (p.front * trainer.spacing) + 'px';
        frontEl.classList.add('hop');
        setTimeout(() => frontEl.classList.remove('hop'), 220);
        updateScoreLine();
      }, 210);

      // Simple teaching status message (not full rules engine)
      setStatus(`P${player} scores ${delta}. New total will be ${newFront}.`);
    }

    function applySettings() {
      trainer.level = parseInt(els.levelSel.value, 10);
      trainer.max = parseInt(els.trackSel.value, 10);
      trainer.players[1].front = trainer.players[1].back = 0;
      trainer.players[2].front = trainer.players[2].back = 0;
      trainer.count = 0;
      trainer.lastPlayer = null;
      buildHoles();
      updateScoreLine();
      setLevelNotes();
      setStatus('New game. Use the buttons to demonstrate scoring.');
    }

    function resetGame() {
      trainer.players[1].front = trainer.players[1].back = 0;
      trainer.players[2].front = trainer.players[2].back = 0;
      trainer.count = 0;
      trainer.lastPlayer = null;
      placePeg(1, true);
      placePeg(2, true);
      updateScoreLine();
      setStatus('Reset. Start pegging again.');
    }

    function sayGo() {
      if (trainer.level < 3) {
        setStatus('“Go” scoring comes in at Level 3. For now just say it; no auto points.', 'warn');
        return;
      }
      if (!trainer.lastPlayer) {
        setStatus('Play at least one card before calling “Go”.', 'warn');
        return;
      }
      const opp = trainer.lastPlayer === 1 ? 2 : 1;
      scorePlayer(opp, 1);
      setStatus(`“Go.” Player ${opp} scores 1 for last card in this segment.`, 'ok');
      trainer.count = 0;
      trainer.lastPlayer = null;
    }

    // 31 check helper (separate from visual track)
    function check31() {
      const n = parseInt(els.countInput.value || '0', 10);
      const out = els.checkOut;
      if (Number.isNaN(n) || n < 0) {
        out.textContent = 'Enter a number between 0 and 31.';
        out.className = 'status warn';
      } else if (n > 31) {
        out.textContent = 'Too high: you may not exceed 31.';
        out.className = 'status warn';
      } else if (n === 31) {
        out.textContent = 'Exact 31 → 2 points in pegging.';
        out.className = 'status ok';
      } else {
        out.textContent = 'Valid. Next card must keep you at or below 31.';
        out.className = 'status';
      }
    }

    /* ---------- WIRING ---------- */
    els.applyBtn.addEventListener('click', applySettings);
    els.resetBtn.addEventListener('click', resetGame);
    els.goBtn.addEventListener('click', sayGo);

    document.querySelectorAll('[data-play]').forEach(btn => {
      btn.addEventListener('click', () => {
        const [pStr, dStr] = btn.dataset.play.split(',');
        const p = parseInt(pStr, 10);
        const delta = parseInt(dStr, 10);
        if (delta > 0) {
          trainer.lastPlayer = p;
        }
        scorePlayer(p, delta);
      });
    });

    els.checkBtn.addEventListener('click', check31);

    window.addEventListener('resize', buildHoles);

    // init
    window.addEventListener('DOMContentLoaded', () => {
      applySettings();
    });
  </script>
</body>
</html>
