<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Peg by Peg – Teaching Suite</title>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#efe6d6; --paper:#fffaf1; --ink:#3e2723; --ink2:#5d4037;
    --wood:#8b5a2b; --frame:#5d4037; --accent:#c49a6c;
    --p1:#c0392b; --p2:#2980b9; --ok:#2e7d32; --warn:#c62828;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Lora,serif;background:var(--bg);color:var(--ink)}
  a{color:inherit}
  /* NAV */
  .nav{
    position:sticky;top:0;z-index:10;background:var(--paper);
    border-bottom:1px solid #e0d0b0; display:flex; gap:.5rem; padding:.6rem 1rem;
  }
  .nav h1{font:700 1.1rem Merriweather;margin:0 .5rem 0 0}
  .nav button{
    appearance:none;border:1px solid #d9c7a7;background:#fff; padding:.35rem .6rem;
    border-radius:.5rem; cursor:pointer; font:600 .9rem Merriweather; color:var(--ink2)
  }
  .nav button.active{background:var(--accent); color:#fff; border-color:var(--frame)}
  /* LAYOUT */
  .wrap{max-width:1100px;margin:1rem auto;padding:0 1rem}
  section{display:none}
  section.active{display:block}
  h2{font:700 1.4rem Merriweather;color:var(--ink2);margin:.5rem 0 0.6rem}
  .card{
    background:var(--paper); border:1px solid #e3d6be; border-radius:12px; padding:1rem;
    box-shadow:0 2px 8px rgba(0,0,0,.06); margin:0 0 1rem;
  }
  .row{display:flex; gap:1rem; flex-wrap:wrap}
  .col{flex:1 1 420px}
  .muted{color:#6d584a; font-size:.92rem}
  .tag{display:inline-block;font:700 .72rem Merriweather; padding:.15rem .45rem; border-radius:.4rem; border:1px solid #d2c1a4; background:#fff}
  /* BOARD */
  .board{background:var(--wood); border:8px solid var(--frame); border-radius:16px; padding:14px;
         box-shadow:0 6px 20px rgba(0,0,0,.35), inset 0 0 10px rgba(0,0,0,.25)}
  .track{
    position:relative; height:54px; margin:18px 0; border:2px solid var(--frame);
    background:#d2b48c; border-radius:10px; box-shadow:inset 0 0 6px rgba(0,0,0,.25);
  }
  .holes{position:absolute; top:26px; left:10px; width:calc(100% - 20px); display:flex; justify-content:space-between; pointer-events:none}
  .hole{width:5px; height:5px; border-radius:50%; background:#3b2618; box-shadow:inset 0 1px 1px rgba(0,0,0,.35)}
  .label{position:absolute; top:-18px; left:6px; font:700 .78rem Merriweather; color:#fff}
  .peg{position:absolute; top:15px; width:20px; height:20px; border-radius:50%; border:2px solid #fff;
       box-shadow:0 2px 5px rgba(0,0,0,.35), inset 0 0 4px rgba(255,255,255,.5); transition:left .22s ease-out}
  .peg.p1{background:var(--p1)} .peg.p2{background:var(--p2)}
  .peg.hop{animation:hop .25s ease-out}
  @keyframes hop{0%{transform:translateY(0)}40%{transform:translateY(-18px)}100%{transform:translateY(0)}}

  /* CONTROLS */
  .controls button{margin:.25rem .25rem 0 0}
  .btn{appearance:none;border:1px solid #c9b693;background:#fff;padding:.45rem .7rem;border-radius:.5rem;cursor:pointer;font:600 .95rem Merriweather}
  .btn.primary{background:var(--accent); color:#fff; border-color:var(--frame)}
  .status{margin-top:.5rem;font-weight:700}
  .status.ok{color:var(--ok)} .status.warn{color:var(--warn)}
  .grid2{display:grid; grid-template-columns:1fr auto; gap:1rem; align-items:center}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:.9rem}
</style>
</head>
<body>
  <div class="nav">
    <h1>Peg by Peg</h1>
    <button data-tab="overview" class="active">Levels Overview</button>
    <button data-tab="trainer">Trainer Board (Lv 1–3)</button>
    <button data-tab="hands">Hand Scoring Trainer (Lv 4)</button>
    <button data-tab="discard">Discard & Crib (Lv 5)</button>
    <button data-tab="official">Official 121 Board (Lv 6)</button>
  </div>

  <div class="wrap">
    <!-- OVERVIEW -->
    <section id="overview" class="active">
      <div class="card">
        <h2>6-Level Cribbage Teaching Path</h2>
        <p class="muted">One rules spine, many faces. Use the Trainer Board and drills to master each level, then graduate to the Official 121 Board.</p>
        <ol>
          <li><strong>Level 1 – Peg to 31</strong>: running count, ≤31, last card, 31 (to 20 pts)</li>
          <li><strong>Level 2 – Pattern Scoring</strong>: 15s (2), pairs (2/6/12), runs (N) (to 40 pts)</li>
          <li><strong>Level 3 – Full Pegging</strong>: add “Go”, segment resets, 31 vs last (to 60 pts)</li>
          <li><strong>Level 4 – The Show</strong>: hand counting mantra: Fifteens → Pairs → Runs → Flush → Nobs</li>
          <li><strong>Level 5 – Discarding</strong>: my crib vs their crib; poison vs feed</li>
          <li><strong>Level 6 – Full Game</strong>: deal → discard → pegging → show → crib (121)</li>
        </ol>
        <p><span class="tag">Tip</span> Use the navbar to jump straight to the matching tool for teaching.</p>
      </div>
    </section>

    <!-- TRAINER BOARD -->
    <section id="trainer">
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="grid2">
              <h2>Trainer Board</h2>
              <div>
                <label class="tag">Level</label>
                <select id="levelSel">
                  <option value="1">1 – Peg to 31</option>
                  <option value="2">2 – +15s / Pairs / Runs</option>
                  <option value="3">3 – +Go & Segments</option>
                </select>
                <label class="tag" style="margin-left:.4rem">Track</label>
                <select id="trackSel">
                  <option value="30">0–30</option>
                  <option value="61">0–61</option>
                  <option value="121" selected>0–121</option>
                </select>
                <button class="btn primary" id="applyBtn">Apply</button>
              </div>
            </div>

            <div class="board" id="board">
              <div class="track" id="t1">
                <div class="label" id="lab1">P1</div>
                <div class="holes" id="holes1"></div>
                <div class="peg p1" id="p1f"></div>
                <div class="peg p1" id="p1b"></div>
              </div>
              <div class="track" id="t2">
                <div class="label" id="lab2">P2</div>
                <div class="holes" id="holes2"></div>
                <div class="peg p2" id="p2f"></div>
                <div class="peg p2" id="p2b"></div>
              </div>
            </div>

            <div class="controls">
              <p class="muted">Use these to simulate card plays while teaching. Values are stand-ins for card values.</p>
              <div>
                <strong>P1:</strong>
                <button class="btn" data-play="1-1">+1</button>
                <button class="btn" data-play="1-2">+2</button>
                <button class="btn" data-play="1-3">+3</button>
                <button class="btn" data-play="1-4">+4</button>
                <button class="btn" data-play="1-5">+5</button>
                <button class="btn" data-play="1--1">-1</button>
              </div>
              <div>
                <strong>P2:</strong>
                <button class="btn" data-play="2-1">+1</button>
                <button class="btn" data-play="2-2">+2</button>
                <button class="btn" data-play="2-3">+3</button>
                <button class="btn" data-play="2-4">+4</button>
                <button class="btn" data-play="2-5">+5</button>
                <button class="btn" data-play="2--1">-1</button>
              </div>
              <div style="margin-top:.4rem">
                <button class="btn" id="goBtn">Say “Go”</button>
                <button class="btn" id="resetBtn">New Game</button>
              </div>
              <div class="status mono" id="status"></div>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card">
            <h2>Level Notes</h2>
            <div id="notes" class="muted"></div>
            <hr/>
            <h3>31 Drill</h3>
            <div>
              <input id="countBox" type="number" min="0" max="31" value="0" style="width:90px;padding:.35rem"/>
              <button class="btn" id="check31">Check</button>
            </div>
            <div id="checkOut" class="status"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- HANDS -->
    <section id="hands">
      <div class="card">
        <h2>Hand Scoring Trainer (Lv 4)</h2>
        <p class="muted">Next step: choose 4 hand cards + starter and we’ll walk the mantra (Fifteens → Pairs → Runs → Flush → Nobs) with a full breakdown. (Scaffold present; logic coming next.)</p>
      </div>
    </section>

    <!-- DISCARD -->
    <section id="discard">
      <div class="card">
        <h2>Discard & Crib Trainer (Lv 5)</h2>
        <p class="muted">Deal 6, keep 4, send 2 to crib (mine vs theirs). We’ll score the hand and crib and give a “feed vs poison” cue. (Scaffold present; logic coming next.)</p>
      </div>
    </section>

    <!-- OFFICIAL -->
    <section id="official">
      <div class="card">
        <h2>Official 121 Board (Lv 6)</h2>
        <p class="muted">Canonical 121 with event log. This is the “graduate” face for real games. (Scaffold present; log/inputs to be added after Lv 4–5.)</p>
      </div>
    </section>
  </div>

<script>
/* ---------- TAB NAV ---------- */
document.querySelectorAll(".nav button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

/* ---------- TRAINER BOARD STATE ---------- */
const S = {
  level: 1, maxPts: 121,
  p: {1:{score:0,prev:0},2:{score:0,prev:0}},
  runCount:0, tail:[], lastPlayer:null, pendingGo:null,
  holes:0, spacing:6
};

const el = {
  holes1:document.getElementById('holes1'),
  holes2:document.getElementById('holes2'),
  p1f:document.getElementById('p1f'), p1b:document.getElementById('p1b'),
  p2f:document.getElementById('p2f'), p2b:document.getElementById('p2b'),
  trackSel:document.getElementById('trackSel'),
  levelSel:document.getElementById('levelSel'),
  applyBtn:document.getElementById('applyBtn'),
  resetBtn:document.getElementById('resetBtn'),
  goBtn:document.getElementById('goBtn'),
  status:document.getElementById('status'),
  notes:document.getElementById('notes'),
  t1:document.getElementById('t1')
};

function setNotes(){
  const L = S.level;
  const msg = L===1?
  `Level 1 – Teach the rhythm. Count aloud, never exceed 31. Scoring emphasized: last card (1) and exact 31 (2).`:
  L===2?
  `Level 2 – Add pattern scoring during pegging: 15 = 2, Pairs = 2/6/12, Runs = N. Order doesn’t matter for runs; no gaps; A is low.`:
  `Level 3 – Full pegging: patterns + “Go”. After a Go or 31, the segment resets. A card cannot score both last-card and 31.`;
  el.notes.textContent = msg;
}

function buildHoles(){
  const inner = el.t1.clientWidth - 20;
  S.spacing = inner / S.maxPts;
  [el.holes1, el.holes2].forEach(div=>{
    div.innerHTML=''; for(let i=0;i<=S.maxPts;i++){const d=document.createElement('div');d.className='hole';div.appendChild(d);}
  });
  placePeg(1); placePeg(2);
}
function placePeg(pn){
  const f = pn===1? el.p1f : el.p2f;
  const b = pn===1? el.p1b : el.p2b;
  f.style.left = (S.p[pn].score * S.spacing) + 'px';
  b.style.left = (S.p[pn].prev  * S.spacing) + 'px';
}
function resetGame(){
  S.p[1].score=S.p[1].prev=0; S.p[2].score=S.p[2].prev=0;
  S.runCount=0; S.tail=[]; S.lastPlayer=null; S.pendingGo=null;
  placePeg(1); placePeg(2); status('New game.'); 
}

function status(s,cls=''){ el.status.className='status mono '+cls; el.status.textContent=s; }

/* Runs detector (end-anchored, simple but effective for teaching) */
function runPoints(tail){
  for(let len=Math.min(tail.length,7); len>=3; len--){
    const slice=tail.slice(-len).slice().sort((a,b)=>a-b);
    let ok=true; for(let i=1;i<slice.length;i++){ if(slice[i]!==slice[i-1]+1){ok=false;break;} }
    if(ok) return len;
  }
  return 0;
}

/* Scoring handlers by level */
function onPlay(pn,val){
  // bounds / level constraints
  if(S.level<=3){
    if(S.runCount + val > 31){ status(`That exceeds 31. Try a smaller value or say "Go".`,'warn'); return; }
    S.runCount += val;
    S.tail.push(val);
    S.lastPlayer = pn;
  }

  // move pegs on the big track (for teaching progress)
  const P = S.p[pn];
  P.prev = P.score;
  P.score = Math.max(0, Math.min(S.maxPts, P.score + val));
  hop(pn);

  // level logic
  let msg = `P${pn} plays ${val}. Count=${S.runCount}. `;
  if(S.level===1){
    if(S.runCount===31){ P.score+=1; msg+=`Exact 31: +2 total. Segment resets.`; resetSegment(); }
  } else if(S.level===2){
    if(S.runCount===15){ P.score+=2; msg+=`15 for 2. `; }
    // pairs (end-run multiplicity)
    const n=S.tail.length, a=S.tail[n-1], b=S.tail[n-2];
    if(n>=2 && a===b){
      let k=2; for(let i=n-3;i>=0 && S.tail[i]===a; i--) k++;
      if(k===2){P.score+=2; msg+=`Pair for 2. `;}
      if(k===3){P.score+=6; msg+=`Three of a kind for 6. `;}
      if(k===4){P.score+=12; msg+=`Four of a kind for 12. `;}
    }
    const rp=runPoints(S.tail); if(rp>0){ P.score+=rp; msg+=`Run for ${rp}. `;}
    if(S.runCount===31){ P.score+=2; msg+=`31 for 2. Reset segment.`; resetSegment(); }
  } else if(S.level===3){
    if(S.runCount===15){ P.score+=2; msg+=`15 for 2. `; }
    const n=S.tail.length, a=S.tail[n-1], b=S.tail[n-2];
    if(n>=2 && a===b){
      let k=2; for(let i=n-3;i>=0 && S.tail[i]===a; i--) k++;
      if(k===2){P.score+=2; msg+=`Pair for 2. `;}
      if(k===3){P.score+=6; msg+=`Trips for 6. `;}
      if(k===4){P.score+=12; msg+=`Quads for 12. `;}
    }
    const rp=runPoints(S.tail); if(rp>0){ P.score+=rp; msg+=`Run for ${rp}. `;}
    if(S.runCount===31){ P.score+=2; msg+=`31 for 2. Reset segment.`; resetSegment(); }
  }
  placePeg(pn);
  status(msg);
  checkWin(pn);
}

function sayGo(){
  if(S.level<3){ status(`“Go” is introduced at Level 3.`,'warn'); return; }
  if(S.lastPlayer==null){ status(`Play at least one card before calling “Go”.`,'warn'); return; }
  const opp = S.lastPlayer===1?2:1;
  S.p[opp].prev=S.p[opp].score; S.p[opp].score+=1; placePeg(opp);
  S.pendingGo = opp;
  status(`“Go.” Player ${opp} scores 1. If they can’t continue, segment resets.`);
}
function resetSegment(){ S.runCount=0; S.tail=[]; S.lastPlayer=null; S.pendingGo=null; }
function checkWin(pn){ if(S.p[pn].score>=S.maxPts){ status(`Player ${pn} wins the race!`,'ok'); } }
function hop(pn){ const peg = pn===1? el.p1f : el.p2f; peg.classList.add('hop'); setTimeout(()=>peg.classList.remove('hop'),240); }

/* UI wiring */
function applySettings(){
  S.level = parseInt(el.levelSel.value,10);
  S.maxPts = parseInt(el.trackSel.value,10);
  buildHoles();
  setNotes();
  resetGame();
}
el.applyBtn.addEventListener('click', applySettings);
el.resetBtn.addEventListener('click', resetGame);
el.goBtn.addEventListener('click', sayGo);
document.querySelectorAll('[data-play]').forEach(b=>{
  b.addEventListener('click',()=>{
    const [p,v]=b.dataset.play.split('-').map(Number);
    onPlay(p,v);
  });
});

/* 31 drill */
document.getElementById('check31').addEventListener('click',()=>{
  const n = parseInt(document.getElementById('countBox').value||'0',10);
  const out = document.getElementById('checkOut');
  if(Number.isNaN(n)||n<0){ out.textContent='Enter 0–31'; out.className='status warn'; return; }
  if(n>31){ out.textContent='Too high: cannot exceed 31.'; out.className='status warn'; return; }
  if(n===31){ out.textContent='Exact 31 → 2 points.'; out.className='status ok'; return; }
  out.textContent='Valid. Next card must keep you ≤ 31.'; out.className='status';
});

/* init */
window.addEventListener('resize', buildHoles);
window.addEventListener('DOMContentLoaded',()=>{
  applySettings(); // default: level 1, 0–121
});
</script>
</body>
</html>
